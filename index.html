-- Criar tabela wallets
CREATE TABLE IF NOT EXISTS wallets (
  id text PRIMARY KEY,
  nome text NOT NULL,
  private_key text UNIQUE NOT NULL,
  balance numeric DEFAULT 0 CHECK (balance >= 0),
  status text DEFAULT 'criada',
  created_at timestamptz DEFAULT now()
);

-- Habilitar RLS (Row Level Security)
ALTER TABLE wallets ENABLE ROW LEVEL SECURITY;

-- Política para permitir leitura própria
CREATE POLICY "Usuários podem ver suas carteiras" ON wallets
FOR SELECT USING (true);

-- Política para permitir INSERT
CREATE POLICY "Permitir criar carteiras" ON wallets
FOR INSERT WITH CHECK (true);

-- Política para permitir UPDATE de balance
CREATE POLICY "Permitir atualizar balance" ON wallets
FOR UPDATE USING (true);