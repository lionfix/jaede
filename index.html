<!DOCTYPE html>
<html>
<head>
<title>âš¡ï¸ PAYEDE GLOBAL v18.2 - SALDO 0 FIXO</title>
<meta name="viewport" content="width=device-width">
<style>
/* [CSS igual ao anterior] */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:system-ui;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px;color:white;}
.login-screen{max-width:400px;margin:0 auto;background:white;color:#333;border-radius:20px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,0.3);}
.logo{text-align:center;margin-bottom:30px;}
.logo h1{font-size:28px;background:linear-gradient(135deg,#4caf50,#28a745);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.input-group{position:relative;margin:20px 0;}
input{width:100%;padding:18px;border:2px solid #e1e5e9;border-radius:12px;font-size:16px;transition:all 0.3s;}
input:focus{outline:none;border-color:#4caf50;box-shadow:0 0 0 3px rgba(76,175,80,0.1);}
.btn{width:100%;padding:18px;border:none;border-radius:12px;font-size:18px;font-weight:600;cursor:pointer;margin:10px 0;transition:all 0.3s;}
.btn-primary{background:linear-gradient(135deg,#4caf50,#45a049);color:white;}
.btn-success{background:linear-gradient(135deg,#28a745,#20c997);color:white;}
.btn-secondary{background:#6c757d;color:white;}
.card{background:white;border-radius:20px;padding:30px;margin:20px 0;box-shadow:0 10px 30px rgba(0,0,0,0.1);}
.balance-display{font-size:32px;font-weight:bold;color:#4caf50;text-align:center;margin:20px 0;}
.hidden{display:none;}
.admin-wallet{background:#d4edda !important;border-left:6px solid #28a745 !important;}
.status{padding:10px;border-radius:8px;margin:10px 0;}
.status.success{background:#d4edda;color:#155724;}
.status.error{background:#f8d7da;color:#721c24;}
@media(max-width:768px){.login-screen{padding:30px 20px;}}
</style>
</head>
<body>
<!-- [HTML igual ao anterior] -->
<div class="login-screen" id="telaLogin">
  <div class="logo">
    <h1>âš¡ï¸ PAYEDE v18.2</h1>
    <div style="font-size:14px;opacity:0.8;">Carteira Digital EDE - SALDO 0 FIXO</div>
  </div>
  
  <div class="input-group">
    <input id="nomeLogin" placeholder="ğŸ‘¤ Nome completo">
  </div>
  
  <div class="input-group">
    <input id="chaveLogin" placeholder="ğŸ”‘ Chave da carteira (opcional)" readonly onclick="this.removeAttribute('readonly');this.focus()">
  </div>
  
  <button class="btn btn-primary" onclick="login()">ğŸš€ ACESSAR CARTEIRA</button>
  <button class="btn btn-secondary" onclick="criarNovaConta()" style="font-size:14px;padding:12px;margin-top:10px;">
    â• CRIAR NOVA CARTEIRA
  </button>
</div>

<div id="dashboard" class="hidden">
  <div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:15px;text-align:center;margin-bottom:20px;">
    <h2>Bem-vindo(a), <span id="nomeUsuarioDash" style="color:#4caf50;"></span>!</h2>
    <div style="font-size:12px;opacity:0.8;">ğŸŒ Chave funciona globalmente!</div>
    <button class="btn btn-secondary" onclick="logout()" style="width:auto;padding:10px 20px;">ğŸ” Sair</button>
  </div>
  
  <!-- Admin -->
  <div class="card admin-wallet">
    <h3>ğŸ‘‘ Admin Master</h3>
    <div class="balance-display">10.000,00 EDE</div>
    <div style="font-size:14px;">
      ğŸ†” PAY000000 | ğŸ” PAYEDE_INT_ADMIN_10000_7b4f2a9c8d3e5f1g2h3i4j5k6l7m8n9o
    </div>
    <button class="btn btn-success" onclick="copiarAdminChave()" style="font-size:14px;">ğŸ“‹ Copiar Admin</button>
  </div>
  
  <!-- Minha Carteira -->
  <div class="card">
    <h3>ğŸ‘¤ Minha Carteira</h3>
    <div class="balance-display" id="meuSaldo">0,00 EDE</div>
    <div id="walletInfo" style="background:#f0f8f0;padding:15px;border-radius:10px;margin:15px 0;display:none;">
      <strong>ğŸ†” ID:</strong> <span id="minhaWalletId"></span><br>
      <strong>ğŸ” Chave:</strong>
    </div>
    <input id="minhaChaveInput" readonly style="font-size:14px;">
    <button class="btn btn-success" onclick="copiarMinhaChave()">ğŸ“‹ Copiar Minha Chave</button>
  </div>
  
  <!-- Ativar -->
  <div class="card" id="secaoAtivar" style="display:none;">
    <h3>ğŸ’° Ativar (R$2 = 10 EDE)</h3>
    <canvas id="qrPicPay" style="display:block;margin:15px auto;width:200px;height:200px;"></canvas>
    <div style="text-align:center;font-size:18px;font-weight:bold;margin:15px 0;">R$ 2,00 PicPay</div>
    <input id="txidPicPay" placeholder="ğŸ“‹ ID transaÃ§Ã£o PicPay">
    <button class="btn btn-primary" onclick="ativarEDE()">ğŸš€ +10 EDE</button>
  </div>
  
  <!-- Transferir -->
  <div class="card">
    <h3>ğŸ”€ Transferir</h3>
    <input id="chaveDestino" placeholder="ğŸ”‘ Chave destino">
    <input id="valorTransferir" type="number" step="0.01" min="0.01" placeholder="ğŸ’° Valor EDE">
    <button class="btn btn-primary" onclick="transferirEDE()">ğŸš€ Transferir</button>
    <div id="statusTransferencia"></div>
  </div>
  
  <!-- Lista -->
  <div class="card">
    <h3>ğŸ“Š Todas Carteiras</h3>
    <div id="listaCarteiras">Carregando...</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
class PayEDE_v182 {
  constructor() {
    // ğŸ”§ LIMPA TUDO ANTIGO na primeira execuÃ§Ã£o
    if(!localStorage.getItem('payede_v182_init')) {
      localStorage.clear();
      localStorage.setItem('payede_v182_init', 'true');
      console.log('ğŸ”¥ LocalStorage LIMPO - v18.2 iniciada');
    }
    
    this.wallets = JSON.parse(localStorage.getItem('payede_v182_wallets')) || [];
    this.pagamentosPicPay = new Set(JSON.parse(localStorage.getItem('payede_v182_picpay')) || []);
    this.totalVendas = parseInt(localStorage.getItem('payede_v182_vendas')) || 0;
    
    // ğŸ›¡ï¸ CORREÃ‡ÃƒO IMEDIATA DE SALDOS
    this.forcarSaldoZero();
    this.criarAdminMaster();
    
    this.minhaCarteira = null;
    this.gerarQRPicPay();
  }
  
  // ğŸ›¡ï¸ FORÃ‡A SALDO ZERO EM TODAS NÃƒO-ADMIN
  forcarSaldoZero() {
    this.wallets = this.wallets.map(w => {
      if(w.id !== 'PAY000000') {
        if(w.balance !== 0) {
          console.log(`âš ï¸ FORÃ‡ADO: ${w.id} saldo corrigido de ${w.balance} â†’ 0`);
          w.balance = 0;
        }
        w.status = w.balance > 0 ? 'ativa' : 'criada';
      }
      return w;
    });
    this.salvarTudo();
  }
  
  criarAdminMaster() {
    const adminExists = this.wallets.find(w => w.id === 'PAY000000');
    if(!adminExists) {
      const admin = {
        id: 'PAY000000',
        nome: 'Seylor Senesh',
        privateKey: 'PAYEDE_INT_ADMIN_10000_7b4f2a9c8d3e5f1g2h3i4j5k6l7m8n9o',
        balance: 10000,
        status: 'admin',
        data: new Date().toLocaleString('pt-BR')
      };
      this.wallets.unshift(admin);
      this.salvarTudo();
      console.log('âœ… Admin criado: 10.000 EDE');
    }
  }
  
  // ğŸ”’ CRIAÃ‡ÃƒO COM SALDO ZERO - IMPOSSÃVEL FALHAR
  criarNovaCarteira(nome) {
    this.totalVendas++;
    const id = `PAY${String(this.totalVendas).padStart(6, '0')}`;
    const chave = `PAYEDE_v182_${Date.now()}_${Math.random().toString(36).substr(2, 20)}`;
    
    // ğŸ›¡ï¸ TRIPLA VERIFICAÃ‡ÃƒO DE SALDO ZERO
    const novaCarteira = {
      id: id,
      nome: nome,
      privateKey: chave,
      balance: 0,  // â† PONTO 1: ZERO aqui
      status: 'criada',
      data: new Date().toLocaleString('pt-BR')
    };
    
    // ğŸ” VERIFICAÃ‡ÃƒO PONTO 2
    if(novaCarteira.balance !== 0) {
      console.error('ğŸš¨ BUG DETECTADO - FORÃ‡ANDO ZERO');
      novaCarteira.balance = 0;
    }
    
    this.wallets.push(novaCarteira);
    this.minhaCarteira = novaCarteira;
    console.log(`âœ… Nova carteira ${id}: saldo FORÃ‡ADO = ${novaCarteira.balance}`);
    
    this.loginSuccess();
    this.salvarTudo();
  }
  
  login(chaveOuNome) {
    let carteira = this.wallets.find(w => 
      w.nome.toLowerCase() === chaveOuNome.toLowerCase() || 
      w.privateKey === chaveOuNome
    );
    
    if(carteira) {
      this.minhaCarteira = carteira;
      this.loginSuccess();
      return true;
    }
    return false;
  }
  
  loginSuccess() {
    document.getElementById('telaLogin').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('nomeUsuarioDash').textContent = this.minhaCarteira.nome;
    document.getElementById('meuSaldo').textContent = `${this.minhaCarteira.balance.toFixed(2)} EDE`;
    document.getElementById('minhaWalletId').textContent = this.minhaCarteira.id;
    document.getElementById('minhaChaveInput').value = this.minhaCarteira.privateKey;
    document.getElementById('walletInfo').style.display = 'block';
    
    if(this.minhaCarteira.balance === 0) {
      document.getElementById('secaoAtivar').style.display = 'block';
    }
    this.atualizarInterface();
  }
  
  ativarEDE(txid) {
    if(this.pagamentosPicPay.has(txid)) return {error: 'TXID jÃ¡ usado'};
    if(!this.minhaCarteira) return {error: 'Sem carteira ativa'};
    
    this.minhaCarteira.balance += 10;
    this.minhaCarteira.status = 'ativa';
    this.pagamentosPicPay.add(txid);
    this.salvarTudo();
    
    this.atualizarSaldo();
    this.atualizarInterface();
    return {success: true, novo_saldo: this.minhaCarteira.balance};
  }
  
  transferirEDE(chaveDestino, valor) {
    const destino = this.wallets.find(w => w.privateKey === chaveDestino);
    if(!destino) return {error: 'Chave destino invÃ¡lida'};
    if(this.minhaCarteira.balance < valor) return {error: 'Saldo insuficiente'};
    
    this.minhaCarteira.balance -= valor;
    destino.balance += valor;
    this.salvarTudo();
    
    this.atualizarSaldo();
    this.atualizarInterface();
    return {success: true, destino: destino.nome};
  }
  
  atualizarInterface() {
    const html = this.wallets.map(w => `
      <div style="padding:15px;border:1px solid #eee;border-radius:10px;margin:10px 0;background:${
        w.id === 'PAY000000' ? '#d4edda' : 
        w.status === 'ativa' ? '#e8f5e8' : '#f9f9f9'
      };">
        <div style="font-weight:bold;">${w.id}</div>
        <div>${w.nome}</div>
        <div style="font-size:20px;color:#4caf50;">${w.balance.toFixed(2)} EDE</div>
        <div style="font-size:12px;">${w.privateKey.slice(0,20)}...</div>
      </div>
    `).join('');
    document.getElementById('listaCarteiras').innerHTML = html;
  }
  
  atualizarSaldo() {
    document.getElementById('meuSaldo').textContent = `${this.minhaCarteira.balance.toFixed(2)} EDE`;
  }
  
  salvarTudo() {
    localStorage.setItem('payede_v182_wallets', JSON.stringify(this.wallets));
    localStorage.setItem('payede_v182_picpay', JSON.stringify([...this.pagamentosPicPay]));
    localStorage.setItem('payede_v182_vendas', this.totalVendas);
  }
  
  gerarQRPicPay() {
    setTimeout(() => {
      try {
        QRCode.toCanvas(document.getElementById('qrPicPay'), 'picpay://pay?username=jaedesystemint&amount=2.00');
      } catch(e) {}
    }, 1000);
  }
}

// ğŸš€ INICIALIZA
const payEDE = new PayEDE_v182();
window.payEDE = payEDE;

// ğŸ¯ FUNÃ‡Ã•ES
function login() {
  const nome = document.getElementById('nomeLogin').value.trim();
  const chave = document.getElementById('chaveLogin').value.trim();
  
  if(chave) {
    if(payEDE.login(chave)) return;
    return alert('âŒ Chave invÃ¡lida!');
  }
  
  if(nome) {
    if(confirm('Criar nova carteira?')) {
      payEDE.criarNovaCarteira(nome);
    }
  } else {
    alert('âŒ Digite nome ou chave!');
  }
}

function criarNovaConta() {
  const nome = document.getElementById('nomeLogin').value.trim() || prompt('Nome completo:');
  if(nome) payEDE.criarNovaCarteira(nome);
}

function ativarEDE() {
  const txid = document.getElementById('txidPicPay').value.trim();
  if(!txid) return alert('âŒ Digite TXID!');
  
  const res = payEDE.ativarEDE(txid);
  if(res.success) {
    alert(`âœ… +10 EDE!\nSaldo: ${res.novo_saldo.toFixed(2)} EDE`);
    document.getElementById('txidPicPay').value = '';
  }
}

function transferirEDE() {
  const chave = document.getElementById('chaveDestino').value.trim();
  const valor = parseFloat(document.getElementById('valorTransferir').value);
  
  if(!chave || valor <= 0) return alert('âŒ Dados invÃ¡lidos!');
  
  const res = payEDE.transferirEDE(chave, valor);
  const statusEl = document.getElementById('statusTransferencia');
  
  if(res.success) {
    statusEl.innerHTML = `<div class="status success">âœ… ${valor.toFixed(2)} EDE â†’ ${res.destino}</div>`;
    document.getElementById('chaveDestino').value = '';
    document.getElementById('valorTransferir').value = '';
  } else {
    statusEl.innerHTML = `<div class="status error">âŒ ${res.error}</div>`;
  }
}

function copiarMinhaChave() {
  navigator.clipboard.writeText(document.getElementById('minhaChaveInput').value).then(() => {
    alert('âœ… Chave GLOBAL copiada!');
  });
}

function copiarAdminChave() {
  navigator.clipboard.writeText('PAYEDE_INT_ADMIN_10000_7b4f2a9c8d3e5f1g2h3i4j5k6l7m8n9o').then(() => {
    alert('âœ… Admin copiado!');
  });
}

function logout() {
  payEDE.minhaCarteira = null;
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('telaLogin').classList.remove('hidden');
  document.getElementById('nomeLogin').value = '';
  document.getElementById('chaveLogin').value = '';
}
</script>
</body>
</html>
