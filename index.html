<!DOCTYPE html>
<html>
<head>
<title>âš¡ï¸ PAYEDE INT. v20.6 - PRIVADO</title>
<meta name="viewport" content="width=device-width">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:system-ui;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px;color:white;}
.login-screen{max-width:400px;margin:0 auto;background:white;color:#333;border-radius:20px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,0.3);}
.logo{text-align:center;margin-bottom:30px;}
.logo h1{font-size:28px;background:linear-gradient(135deg,#4caf50,#28a745);background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.input-group{position:relative;margin:20px 0;}
input{width:100%;padding:18px;border:2px solid #e1e5e9;border-radius:12px;font-size:16px;transition:all 0.3s;}
input:focus{outline:none;border-color:#4caf50;box-shadow:0 0 0 3px rgba(76,175,80,0.1);}
.btn{width:100%;padding:18px;border:none;border-radius:12px;font-size:18px;font-weight:600;cursor:pointer;margin:10px 0;transition:all 0.3s;}
.btn-primary{background:linear-gradient(135deg,#4caf50,#45a049);color:white;}
.btn-success{background:linear-gradient(135deg,#28a745,#20c997);color:white;}
.btn-secondary{background:#6c757d;color:white;}
.card{background:white;border-radius:20px;padding:30px;margin:20px 0;box-shadow:0 10px 30px rgba(0,0,0,0.1);}
.balance-display{font-size:32px;font-weight:bold;color:#4caf50;text-align:center;margin:20px 0;}
.hidden{display:none;}
.admin-wallet{background:#d4edda !important;border-left:6px solid #28a745 !important;}
.status{padding:10px;border-radius:8px;margin:10px 0;}
.status.success{background:#d4edda;color:#155724;}
.status.error{background:#f8d7da;color:#721c24;}
.minhas-carteiras{background:#e8f5e8 !important;border-left:6px solid #28a745 !important;}
@media(max-width:768px){.login-screen{padding:30px 20px;}}
</style>
</head>
<body>
<div class="login-screen" id="telaLogin">
  <div class="logo">
    <h1>âš¡ï¸ PAYEDE INT. v20.6</h1>
    <div style="font-size:14px;opacity:0.8;">Carteira Digital EDE - PRIVADA</div>
  </div>
  
  <div class="input-group">
    <input id="nomeLogin" placeholder="ğŸ‘¤ Nome completo">
  </div>
  
  <div class="input-group">
    <input id="chaveLogin" placeholder="ğŸ”‘ Chave da carteira" readonly onclick="this.removeAttribute('readonly');this.focus()">
  </div>
  
  <button class="btn btn-primary" onclick="acessarCarteira()">
    ğŸš€ ACESSAR CARTEIRA
  </button>
  <button class="btn btn-secondary" onclick="novaCarteira()" style="font-size:14px;padding:12px;">
    â• CRIAR NOVA CARTEIRA
  </button>
</div>

<div id="dashboard" class="hidden">
  <div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:15px;text-align:center;margin-bottom:20px;">
    <h2>Bem-vindo(a), <span id="nomeUsuarioDash" style="color:#4caf50;"></span>!</h2>
    <button class="btn btn-secondary" onclick="sair()" style="width:auto;padding:10px 20px;">ğŸ” Sair</button>
  </div>
  
  <!-- ADMIN (sempre visÃ­vel) -->
  <div class="card admin-wallet">
    <h3>ğŸ‘‘ Admin Master</h3>
    <div class="balance-display">10.000,00 EDE</div>
    <div>PAYEDE_INT_ADMIN_10000_7b4f2a9c8d3e5f1g2h3i4j5k6l7m8n9o</div>
    <button class="btn btn-success" onclick="copiarAdmin()" style="font-size:14px;">ğŸ“‹ Copiar Admin</button>
  </div>
  
  <!-- MINHA CARTEIRA ATIVA -->
  <div class="card minhas-carteiras">
    <h3>ğŸ‘¤ Carteira Ativa</h3>
    <div class="balance-display" id="meuSaldo">0,00 EDE</div>
    <div id="walletInfo" style="background:#f0f8f0;padding:15px;border-radius:10px;margin:15px 0;">
      <strong>ğŸ†” ID:</strong> <span id="minhaWalletId"></span><br>
      <strong>ğŸ” Chave:</strong>
      <input id="minhaChaveInput" readonly style="font-size:14px;">
    </div>
    <button class="btn btn-success" onclick="copiarMinhaChave()">ğŸ“‹ Copiar Minha Chave</button>
  </div>
  
  <!-- ATIVAR -->
  <div class="card" id="secaoAtivar" style="display:none;">
    <h3>ğŸ’° Ativar (R$2 = 10 EDE)</h3>
    <canvas id="qrPicPay" style="display:block;margin:15px auto;width:200px;height:200px;"></canvas>
    <div style="text-align:center;font-size:18px;font-weight:bold;margin:15px 0;">R$ 2,00 PicPay</div>
    <input id="txidPicPay" placeholder="ğŸ“‹ ID transaÃ§Ã£o">
    <button class="btn btn-primary" onclick="ativar()">ğŸš€ +10 EDE</button>
  </div>
  
  <!-- MINHAS CARTEIRAS (sÃ³ as minhas) -->
  <div class="card">
    <h3>ğŸ‘› Minhas Carteiras</h3>
    <div id="minhasCarteirasLista"></div>
  </div>
  
  <!-- TRANSFERIR -->
  <div class="card">
    <h3>ğŸ”€ Transferir</h3>
    <input id="chaveDestino" placeholder="ğŸ”‘ Chave destino">
    <input id="valorTransferir" type="number" step="0.01" placeholder="ğŸ’° Valor EDE">
    <button class="btn btn-primary" onclick="transferir()">ğŸš€ Transferir</button>
    <div id="statusTransferencia"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
// v20.6 - CADA USUÃRIO SÃ“ VÃŠ SUAS CARTEIRAS
let todasWallets = [];  // Todas carteiras (para transferÃªncias)
let minhasWallets = []; // SÃ³ minhas carteiras
let minhaCarteira = null;
let pagamentos = new Set();
let contador = 1;
let usuarioAtual = null;

function initApp() {
  carregarDados();
  
  // Admin sempre existe
  if(!todasWallets.find(w => w.id === 'PAY000000')) {
    todasWallets.unshift({
      id: 'PAY000000',
      nome: 'Seylor Senesh',
      privateKey: 'PAYEDE_INT_ADMIN_10000_7b4f2a9c8d3e5f1g2h3i4j5k6l7m8n9o',
      balance: 10000,
      status: 'admin'
    });
  }
  
  salvarDados();
}

function carregarDados() {
  let data = localStorage.getItem('payede_data_v206');
  if(data) {
    let parsed = JSON.parse(data);
    todasWallets = parsed.todas || [];
    minhasWallets = parsed.minhas || [];
    contador = parsed.contador || 1;
    usuarioAtual = parsed.usuario || null;
  }
}

function salvarDados() {
  localStorage.setItem('payede_data_v206', JSON.stringify({
    todas: todasWallets,
    minhas: minhasWallets,
    contador: contador,
    usuarioAtual: usuarioAtual
  }));
  localStorage.setItem('payede_pagamentos_v206', JSON.stringify([...pagamentos]));
}

function novaCarteira() {
  let nome = document.getElementById('nomeLogin').value.trim();
  if(!nome) return alert('Digite seu nome!');
  
  contador++;
  let nova = {
    id: 'PAY' + contador.toString().padStart(6, '0'),
    nome: nome,
    privateKey: 'PAYEDE_v206_' + Date.now() + '_' + Math.random().toString(36).substr(2, 15),
    balance: 0,
    status: 'criada',
    dono: nome  // â† ASSINATURA DO DONO
  };
  
  // Adiciona nas minhas E nas todas
  minhasWallets.push(nova);
  todasWallets.push(nova);
  usuarioAtual = nome;
  minhaCarteira = nova;
  
  mostrarDashboard();
  salvarDados();
  copiarMinhaChave();
  alert(`âœ… Carteira ${nova.id} criada!
ğŸ’° Saldo: 0 EDE`);
}

function acessarCarteira() {
  let nome = document.getElementById('nomeLogin').value.trim();
  let chave = document.getElementById('chaveLogin').value.trim();
  
  if(chave) {
    // Busca por chave
    minhaCarteira = todasWallets.find(w => w.privateKey === chave);
    if(minhaCarteira) {
      usuarioAtual = minhaCarteira.dono;
      minhasWallets = todasWallets.filter(w => w.dono === usuarioAtual);
      mostrarDashboard();
      return;
    }
    alert('âŒ Chave invÃ¡lida!');
    return;
  }
  
  if(nome) {
    // Busca minhas carteiras
    minhasWallets = todasWallets.filter(w => w.dono && w.dono.toLowerCase() === nome.toLowerCase());
    if(minhasWallets.length > 0) {
      usuarioAtual = nome;
      minhaCarteira = minhasWallets[0]; // Primeira carteira
      mostrarDashboard();
      return;
    }
  }
  
  if(nome && confirm('Criar nova carteira privada?')) {
    novaCarteira();
  }
}

function mostrarDashboard() {
  document.getElementById('telaLogin').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  document.getElementById('nomeUsuarioDash').textContent = usuarioAtual;
  document.getElementById('meuSaldo').textContent = minhaCarteira.balance.toFixed(2) + ' EDE';
  document.getElementById('minhaWalletId').textContent = minhaCarteira.id;
  document.getElementById('minhaChaveInput').value = minhaCarteira.privateKey;
  document.getElementById('walletInfo').style.display = 'block';
  
  if(minhaCarteira.balance === 0) {
    document.getElementById('secaoAtivar').style.display = 'block';
  }
  
  atualizarMinhasCarteiras();
}

function atualizarMinhasCarteiras() {
  document.getElementById('minhasCarteirasLista').innerHTML = minhasWallets.map(w => `
    <div style="padding:12px;border:1px solid #ddd;border-radius:8px;margin:8px 0;background:#f0f8f0;cursor:pointer;" 
         onclick="selecionarCarteira('${w.id}')">
      <strong>${w.id}</strong><br>${w.nome}<br>
      <span style="font-size:18px;color:#4caf50;">${w.balance.toFixed(2)} EDE</span>
    </div>
  `).join('') || '<div style="text-align:center;color:#666;">Nenhuma outra carteira</div>';
}

function selecionarCarteira(id) {
  minhaCarteira = minhasWallets.find(w => w.id === id);
  document.getElementById('meuSaldo').textContent = minhaCarteira.balance.toFixed(2) + ' EDE';
  document.getElementById('minhaWalletId').textContent = minhaCarteira.id;
  document.getElementById('minhaChaveInput').value = minhaCarteira.privateKey;
  
  if(minhaCarteira.balance === 0) {
    document.getElementById('secaoAtivar').style.display = 'block';
  }
}

function ativar() {
  let txid = document.getElementById('txidPicPay').value.trim();
  if(!txid) return alert('Digite TXID!');
  if(pagamentos.has(txid)) return alert('TXID usado!');
  
  minhaCarteira.balance += 10;
  minhaCarteira.status = 'ativa';
  pagamentos.add(txid);
  
  // Atualiza em todas as listas
  let indexTodas = todasWallets.findIndex(w => w.id === minhaCarteira.id);
  if(indexTodas > -1) todasWallets[indexTodas] = minhaCarteira;
  let indexMinhas = minhasWallets.findIndex(w => w.id === minhaCarteira.id);
  if(indexMinhas > -1) minhasWallets[indexMinhas] = minhaCarteira;
  
  salvarDados();
  document.getElementById('meuSaldo').textContent = minhaCarteira.balance.toFixed(2) + ' EDE';
  document.getElementById('txidPicPay').value = '';
  atualizarMinhasCarteiras();
  alert('âœ… +10 EDE!');
}

function transferir() {
  let chaveDest = document.getElementById('chaveDestino').value.trim();
  let valor = parseFloat(document.getElementById('valorTransferir').value);
  
  let destino = todasWallets.find(w => w.privateKey === chaveDest);
  if(!destino) return alert('âŒ Chave nÃ£o encontrada!');
  if(minhaCarteira.balance < valor) return alert('âŒ Saldo insuficiente!');
  
  minhaCarteira.balance -= valor;
  destino.balance += valor;
  destino.status = 'ativa';
  
  // Atualiza listas
  let indexMinhas = minhasWallets.findIndex(w => w.id === minhaCarteira.id);
  if(indexMinhas > -1) minhasWallets[indexMinhas] = minhaCarteira;
  let indexTodasDest = todasWallets.findIndex(w => w.id === destino.id);
  if(indexTodasDest > -1) todasWallets[indexTodasDest] = destino;
  
  salvarDados();
  document.getElementById('meuSaldo').textContent = minhaCarteira.balance.toFixed(2) + ' EDE';
  document.getElementById('statusTransferencia').innerHTML = '<div class="status success">âœ… Transferido!</div>';
  atualizarMinhasCarteiras();
}

function copiarMinhaChave() {
  navigator.clipboard.writeText(document.getElementById('minhaChaveInput').value);
  alert('âœ… Chave copiada!');
}

function copiarAdmin() {
  navigator.clipboard.writeText('PAYEDE_INT_ADMIN_10000_7b4f2a9c8d3e5f1g2h3i4j5k6l7m8n9o');
  alert('âœ… Admin copiado!');
}

function sair() {
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('telaLogin').classList.remove('hidden');
  minhaCarteira = null;
  usuarioAtual = null;
}

setTimeout(() => {
  try {
    QRCode.toCanvas(document.getElementById('qrPicPay'), 'picpay://pay?username=jaedesystemint&amount=2.00');
  } catch(e) {}
}, 1000);

initApp();
</script>
</body>
</html>